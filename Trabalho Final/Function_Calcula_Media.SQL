CREATE DEFINER=`root`@`localhost` FUNCTION `CALCULA_MEDIA`(
CLIENTE INTEGER) RETURNS float
BEGIN
DECLARE SOMA_MEDIA FLOAT;
DECLARE CONTADOR INTEGER;
DECLARE MEDIA FLOAT;

 SELECT SUM(AVALIACAO_PEDIDO.AV_MEDIA) SOMA_NOTAS,COUNT(AVALIACAO_PEDIDO.AV_ID) CONT
    FROM AVALIACAO_PEDIDO,
    PEDIDO, ENTIDADE
    WHERE AVALIACAO_PEDIDO.AV_PEDIDO = PEDIDO.PED_ID
    AND ENTIDADE.ENT_ID = PEDIDO.PED_CLIENTE_ID
    AND PEDIDO.PED_CLIENTE_ID = CLIENTE
    INTO SOMA_MEDIA, CONTADOR;
    
    SET MEDIA = 0 ;
    IF CONTADOR > 1 THEN
      SET MEDIA = SOMA_MEDIA/CONTADOR;
    ELSE  
      SET MEDIA = SOMA_MEDIA;
	END IF;
    
    

RETURN MEDIA;
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `CALCULAR_TX_ADM`(
NOTA_FISCAL INTEGER)
 BEGIN
DECLARE VALOR_TOTAL FLOAT;
 DECLARE ID_ITEM_TAXA INTEGER;
DECLARE VALOR_UNITARIO FLOAT;
	SELECT SUM(NI_VALOR_TOTAL) FROM NOTA_ITEM
    WHERE NI_PEDIDO = NOTA_FISCAL
    INTO VALOR_TOTAL;
    
    SELECT PRODUTO.P_ID,PRODUTO.P_VALOR FROM PRODUTO
    WHERE PRODUTO.P_NOME = 'TAXA ADM'
    INTO ID_ITEM_TAXA, VALOR_UNITARIO;
    
    SET VALOR_TOTAL = VALOR_TOTAL*(VALOR_UNITARIO/100);
    
    
INSERT INTO NOTA_ITEM(NI_PEDIDO,NI_PRODUTO,NI_VALOR_UNITARIO,NI_VALOR_TOTAL,NI_QUANTIDADE)
	VALUES(NOTA_FISCAL,ID_ITEM_TAXA,VALOR_TOTAL,VALOR_TOTAL,1); 

END

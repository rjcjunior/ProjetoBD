

CREATE TABLE ENTIDADE(
ENT_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
ENT_NOME VARCHAR(60),
ENT_CLIENTE CHAR(1),
ENT_PROFISSIONAL CHAR(1),
ENT_EMPRESA CHAR(1),
ENT_TIPO_PESSOA CHAR(1),
ENT_CPF VARCHAR(14),
ENT_CNPJ VARCHAR(14));

CREATE TABLE TIPO_TELEFONE(
TTEL_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
TTEL_DESCRICAO VARCHAR(10));

CREATE TABLE ENTIDADE_TELEFONE(
TEL_ENTIDADE_ID INTEGER AUTO_INCREMENT,
TEL_ENTIDADE_NUMERO INTEGER PRIMARY KEY,
TEL_ENTIDADE_TIPO INTEGER,

CONSTRAINT FK_ENTIDADE FOREIGN KEY (TEL_ENTIDADE_ID) REFERENCES ENTIDADE(ENT_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION, 

CONSTRAINT FK_TIPO_TELEFONE FOREIGN KEY (TEL_ENTIDADE_TIPO) REFERENCES TIPO_TELEFONE(TTEL_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION
);


CREATE TABLE TIPO_ENDERECO(
TEND_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
TEND_DESCRICAO VARCHAR(10));

CREATE TABLE CIDADE(
CIDADE_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
CIDADE_DESCRICAO VARCHAR(60));


CREATE TABLE ENTIDADE_ENDERECO(
END_ENTIDADE_ID INTEGER AUTO_INCREMENT,
END_ENTIDADE_TIPO INTEGER,
END_ENTIDADE_DESCRICAO VARCHAR(80),
END_ENTIDADE_COMPLEMENTO VARCHAR(30),
END_ENTIDADE_CIDADE INTEGER,
END_ENTIDADE_CEP INTEGER,
CONSTRAINT FK_ENDERECO FOREIGN KEY (END_ENTIDADE_ID) REFERENCES ENTIDADE(ENT_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION,

CONSTRAINT FK_TIPO_ENDERECO FOREIGN KEY (END_ENTIDADE_TIPO) REFERENCES TIPO_ENDERECO(TEND_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION,

CONSTRAINT FK_CIDADE FOREIGN KEY (END_ENTIDADE_CIDADE) REFERENCES CIDADE(CIDADE_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION

);

CREATE TABLE CATEGORIA(
CAT_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
CAT_ENTIDADE_ID INTEGER,
CAT_DESCRICAO VARCHAR(60),
CONSTRAINT FK_CATEGORIA FOREIGN KEY (CAT_ENTIDADE_ID) REFERENCES ENTIDADE(ENT_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION
);


CREATE TABLE UNIDADE(
U_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
U_DESCRICAO VARCHAR(20));


CREATE TABLE PRODUTO(
P_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
P_ENTIDADE_ID INTEGER,
P_NOME VARCHAR(60),
P_DESCRICAO VARCHAR(255),
P_VALOR FLOAT,
P_UNIDADE INTEGER,
CONSTRAINT FK_PRODUTO FOREIGN KEY (P_ENTIDADE_ID) REFERENCES ENTIDADE(ENT_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION,
CONSTRAINT FK_PRODUTO_UNIDADE FOREIGN KEY (P_UNIDADE) REFERENCES UNIDADE(U_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION);


CREATE TABLE EQUIPE(
EQ_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
EQ_GERENTE_ID INTEGER,
EQ_NOME VARCHAR(60),
CONSTRAINT FK_EQUIPE FOREIGN KEY (EQ_GERENTE_ID) REFERENCES ENTIDADE(ENT_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION);

CREATE TABLE EQUIPE_STAFF(
EQS_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
EQS_EQUIPE INTEGER ,
EQS_ENTIDADE_ID INTEGER,
CONSTRAINT FK_EQUIPE_STAFF FOREIGN KEY (EQS_EQUIPE) REFERENCES EQUIPE(EQ_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION, 
CONSTRAINT FK_EQUIPE_ENTIDADE FOREIGN KEY (EQS_ENTIDADE_ID) REFERENCES ENTIDADE(ENT_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION);

CREATE TABLE TIPO_FESTA(
TFESTA_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
TDESCRICAO_FESTA VARCHAR(80));


CREATE TABLE PACOTE(
PAC_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
PAC_DESCRICAO VARCHAR(40),
PAC_TIPO_FESTA INTEGER,
CONSTRAINT FK_PACOTE_FESTA FOREIGN KEY (PAC_TIPO_FESTA) REFERENCES TIPO_FESTA(TFESTA_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION);

CREATE TABLE PACOTE_ITEM(
IPAC_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
IPAC_PACOTE INTEGER,
IPAC_QUANTIDADE INTEGER,
IPAC_VALOR_UNITARIO FLOAT,
IPAC_VALOR_TOTAL FLOAT,
IPAC_PRODUTO integer,
CONSTRAINT FK_PACOTE_ITEM FOREIGN KEY (IPAC_PACOTE) REFERENCES PACOTE(PAC_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION,
CONSTRAINT FK_PACOTE_PRODUTO FOREIGN KEY (IPAC_PRODUTO) REFERENCES PRODUTO(P_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION);



CREATE TABLE PEDIDO(
PED_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
PED_DATA DATE,
PED_CLIENTE_ID INTEGER,
PED_TIPO_FESTA INTEGER,
PED_STATUS CHAR(1),
CONSTRAINT FK_PEDIDO_CLIENTE FOREIGN KEY (PED_CLIENTE_ID) REFERENCES ENTIDADE(ENT_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION,

CONSTRAINT FK_PEDIDO_TIPO_FESTA FOREIGN KEY (PED_TIPO_FESTA) REFERENCES TIPO_FESTA(TFESTA_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION);

CREATE TABLE PEDIDO_ITEM(
PI_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
PI_PEDIDO INTEGER,
PI_PRODUTO INTEGER,
PI_VALOR_UNITARIO FLOAT,
PI_VALOR_TOTAL FLOAT,
PI_QUANTIDADE INTEGER
CONSTRAINT FK_ITEM_PEDIDO FOREIGN KEY (PI_PEDIDO) REFERENCES PEDIDO(PED_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION,

CONSTRAINT FK_ITEM_PRODUTO FOREIGN KEY (PI_PRODUTO) REFERENCES PRODUTO(P_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION);

CREATE TABLE NOTA_FISCAL(
NF_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
NF_DATA DATE,
NF_CLIENTE INTEGER,
NF_TIPO_FESTA INTEGER,
NF_PEDIDO INTEGER,
CONSTRAINT FK_NOTA_CLIENTE FOREIGN KEY (NF_CLIENTE) REFERENCES ENTIDADE(ENT_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION,

CONSTRAINT FK_NOTA_TIPO_FESTA FOREIGN KEY (NF_TIPO_FESTA) REFERENCES TIPO_FESTA(TFESTA_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION,
CONSTRAINT FK_NOTA_PEDIDO FOREIGN KEY (NF_PEDIDO ) REFERENCES PEDIDO(PED_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION);


CREATE TABLE NOTA_ITEM(
NI_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
NI_PEDIDO INTEGER,
NI_PRODUTO INTEGER,
NI_VALOR_UNITARIO FLOAT,
NI_VALOR_TOTAL FLOAT,
NI_QUANTIDADE INTEGER,
CONSTRAINT FK_ITEM_NOTA FOREIGN KEY (NI_PEDIDO) REFERENCES NOTA_FISCAL(NF_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION,

CONSTRAINT FK_ITEM_NPRODUTO FOREIGN KEY (NI_PRODUTO) REFERENCES PRODUTO(P_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION);

CREATE TABLE AVALIACAO_PEDIDO(
AV_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
AV_PEDIDO INTEGER,
AV_MEDIA FLOAT,

CONSTRAINT FK_AVA_PEDIDO FOREIGN KEY (AV_PEDIDO) REFERENCES PEDIDO(PED_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION);

CREATE TABLE AVALIACAO_ITEM_PEDIDO(
AVI_ID INTEGER PRIMARY KEY AUTO_INCREMENT,
AVI_AVALIACAO INTEGER,
AVI_PEDIDO INTEGER,
AVI_PEDIDO_ITEM INTEGER,
AVI_NOTA INTEGER,
CONSTRAINT FK_AVI_AVALIACAO FOREIGN KEY (AVI_AVALIACAO) REFERENCES AVALIACAO_PEDIDO(AV_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION,

CONSTRAINT FK_AVI_PEDIDO FOREIGN KEY (AVI_PEDIDO) REFERENCES  PEDIDO(PED_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION,

CONSTRAINT FK_AVI_PEDIDO_ITEM FOREIGN KEY (AVI_PEDIDO_ITEM) REFERENCES  PEDIDO_ITEM(PI_ID)

ON UPDATE NO ACTION ON DELETE NO ACTION);


ALTER TABLE `EVENTO`.`PRODUTO` 
ADD INDEX `PRODUTO_NOME_IDX` (`P_NOME` ASC);




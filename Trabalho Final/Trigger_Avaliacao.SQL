CREATE DEFINER=`root`@`localhost` TRIGGER `EVENTO`.`AVALIACAO_ITEM_PEDIDO_AFTER_INSERT` AFTER INSERT ON `AVALIACAO_ITEM_PEDIDO` FOR EACH ROW
 BEGIN
 DECLARE SOMA_NOTAS FLOAT;
DECLARE CONTADOR INTEGER;

	SELECT SUM(AVI_NOTA), COALESCE(COUNT(AVI_ID),1) FROM AVALIACAO_ITEM_PEDIDO
	WHERE AVI_AVALIACAO = NEW.AVI_AVALIACAO
	INTO SOMA_NOTAS, CONTADOR;

	UPDATE AVALIACAO_PEDIDO 
    SET AV_MEDIA = SOMA_NOTAS/CONTADOR
    WHERE AV_ID = NEW.AVI_AVALIACAO;
END
